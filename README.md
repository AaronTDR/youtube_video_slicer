# YouTube Video Slicer

## Description

This script allows to extract timestamps from YouTube videos or videos stored on the operating system. For each timestamp a section of the original video is obtained and finally a new video is created by concatenating all the resulting sections.

## Setup

Before using this script, make sure you have the following requirements installed:

- Node
- GIT
- yt-dlp

### Installing yt-dlp with Python package manager

```bash
pip install yt-dlp
```

## Usage

### Repository Cloning

Clone the YouTube Video Slicer repository using the following command:

```
git clone https://github.com/AaronTDR/youtube_video_slicer.git
```

Alternatively, you can install the npm dependencies by running:

```
npm install
```

## Instructions

1. Open the `index.js` file.
2. Locate and properly configure the config file.
3. Execute the script using the `node index.js` command.

The script will process the videos according to the specified timestamps, generating a new video for each timestamp in addition to concatenating the corresponding sections.

## Object config values

## Script Configuration

The `config` file contains the following configuration options:

- **ffmpeg_exe_path**: Specifies the path to the `ffmpeg` executable, used for processing videos.

- **ffprobe_exe_path**: Defines the path to the `ffprobe` executable, used for retrieving detailed information about media files.

- **workingFolderPath**: Folder where the results generated by the script are stored.

- **segmentsFolderPath**: Folder where the downloaded and processed video segments are saved.

- **deleteDownloadedVideos**: Boolean indicating whether to delete the downloaded videos after processing (`true` to delete, `false` to keep them).

- **timestamps**: List of objects defining the time intervals (`start` and `end`) and the source of the video (either a YouTube URL or a local file path).

  - **start**: Start time of the video segment, in `hh:mm:ss.sss` format.
  - **end**: End time of the video segment, in `hh:mm:ss.sss` format.
  - **url**: YouTube URL of the video to process (if applicable).
  - **path**: Local file path of the video (if applicable).

- **concurrencyLimit**: Maximum number of concurrent tasks the script can run simultaneously.

- **targetFormat**: Format in which the generated video files will be saved (e.g., `.webm`).

- **shortsConfig**: Specific configuration for YouTube Shorts videos.

  - **shortThumbnailPath**: Path to the image used as a thumbnail for the short video.
  - **generateThumbnail**: Boolean indicating whether to automatically generate a thumbnail for the short video.

- **isYoutubeShort**: Boolean indicating whether the content being processed is a YouTube Short (`true` to enable).

Example of a timestamp format:

```
[
  { start: "HH:MM:SS.sss", end: "HH:MM:SS.sss" }
]
```

## Below is a brief description of the main internal processes within the `ytConcatenateSlices` function.

### Principal functions

- `downloadVideoYtDlp`
- `captureAndCutVideo`
- `concatenateVideos`

## ytConcatenateSlices Function Overview

The `ytConcatenateSlices` function performs several steps to validate, download, cut, and concatenate video segments. Below is a brief description of each step:

1. **Validations**:  
   The function begins by running validations on the `timestamps`, `workingFolderPath`, and `segmentsFolderPath` to ensure the required inputs are valid.

2. **Filter Duplicate URLs**:  
   It filters out duplicate URLs from the `timestamps` array, so each URL is only downloaded once.

3. **Asynchronous Video Download**:  
   All unique videos are downloaded concurrently using the `downloadVideoYtDlp` function. The results of the download are stored in an array.

4. **Filter Null Results**:  
   The function then filters out any `null` values from the download results to retain only valid file paths.

5. **Cut and Concatenate Video**:  
   It proceeds to cut and concatenate the video segments using a helper function.

6. **Delete Temporary Videos**:  
   If the `deleteDownloadedVideos` option is enabled, the function attempts to delete the downloaded video files after processing. Any errors during this step are logged.

7. **Log Source Video Paths**:  
   The file paths of the source videos are logged, as long as they exist and are not undefined.

8. **Completion Message**:  
   Finally, the function logs a message indicating that the process is complete.

In case of errors at any stage, they are caught and logged with an error message.
